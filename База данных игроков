namespace DataBase;
class Program
{
    static void Main(string[] args)
    {
        const string ShowDataBaseCommand = "1";
        const string AddPlayerCommand = "2";
        const string RemovePlayerCommand = "3";
        const string BanPlayerCommand = "4";
        const string UnbanPlayerCommand = "5";
        const string ExitCommand = "6";

        string userInput;
        bool isWorking = true;

        DataBase data = new DataBase();

        while (isWorking)
        {
            Console.WriteLine($"Введите - {ShowDataBaseCommand}, чтобы посмотреть базу данных.\n" +
                              $"Введите - {AddPlayerCommand}, чтобы добавить игрока.\n" +
                              $"Введите - {RemovePlayerCommand}, чтобы удалить игрока.\n" +
                              $"Введите - {BanPlayerCommand}, чтобы забанить игрока.\n" +
                              $"Введите - {UnbanPlayerCommand}, чтобы разбанить игрока.\n" +
                              $"Введите - {ExitCommand}, чтобы выйти из программы.");

            userInput = Console.ReadLine();

            switch (userInput)
            {
                case ShowDataBaseCommand:
                    data.ShowAllPlayers();
                    break;

                case AddPlayerCommand:
                    data.AddPlayer();
                    break;

                case RemovePlayerCommand:
                    data.RemovePlayer();
                    break;

                case BanPlayerCommand:
                    data.Ban();
                    break;

                case UnbanPlayerCommand:
                    data.Unban();
                    break;

                case ExitCommand:
                    isWorking = false;
                    break;

                default:
                    Console.WriteLine("Такой команды не существует.");
                    break;
            }
        }
    }
}

class Player
{
    public Player(int id, string name, int level, bool isBan)
    {
        Id = id;
        Name = name;
        Level = level;
        IsBanned = isBan;
    }

    public int Id { get; private set; }
    public string Name { get; private set; }
    public int Level { get; private set; }
    public bool IsBanned { get; private set; }

    public void Ban()
    {
        IsBanned = true;
    }

    public void Unban()
    {
        IsBanned = false;
    }

    public void ShowPlayers()
    {
        Console.WriteLine($"Пользователь {Name}#{Id} {Level}lvl Бан: {IsBanned}");
    }
}

class DataBase
{
    private List<Player> _players;
    public DataBase()
    {
        _players = new List<Player>();
    }
    public void ShowAllPlayers()
    {
        Console.Clear();

        if (_players.Count == 0)
        {
            ShowMessageEmptyData();
        }

        foreach (Player player in _players)
        {
            player.ShowPlayers();
        }

        Console.ReadKey();
        Console.Clear();

    }

    public void AddPlayer()
    {
        string nameInput;
        bool isBan = false;
        int level;
        int id;

        Console.Clear();

        Console.Write("Введите ID игрока: ");

        id = GetUserInputInt();

        while(IsPlayerExist(id))
        {
            Console.WriteLine("Пользователь с таким ID уже есть. Введите другой.");
            id = GetUserInputInt();
        }

        Console.Write("Введите уровень игрока: ");

        level = GetUserInputInt();

        nameInput = GetUserInput("Введите никнейм игрока: ", "Введено некорректное значение, попробуй еще раз.");

        Console.Clear();

        Player player = new Player(id, nameInput, level, isBan);

        _players.Add(player);

        Console.WriteLine($"Пользователь создан.");
        Console.ReadKey();
        Console.Clear();
    }

    public void RemovePlayer()
    {
        int id;

        Console.Clear();

        if (_players.Count == 0)
        {
            ShowMessageEmptyData();
        }
        else
        {
            Console.WriteLine("Введите ID игрока: ");

            id = GetUserInputInt();

            if (TryGetPlayer(id, out Player player))
            {
                _players.Remove(player);
                Console.WriteLine("Пользователь удален.");
                Console.ReadKey();
                Console.Clear();
            }
            else
            {
                ShowMassegeNoPlayer();
            }

        }
    }

    public void Ban()
    {
        int id;

        Console.Clear();

        if (_players.Count == 0)
        {
            ShowMessageEmptyData();
        }
        else
        {
            Console.WriteLine("Введите ID игрока, которго хотите забанить: ");

            id = GetUserInputInt();

            if (TryGetPlayer(id, out Player player))
            {
                player.Ban();
                Console.WriteLine("Игрок забанен.");
                Console.ReadKey();
                Console.Clear();
            }
            else
            {
                ShowMassegeNoPlayer();
            }
        }
    }

    public void Unban()
    {
        int id;

        Console.Clear();

        if (_players.Count == 0)
        {
            ShowMessageEmptyData();
        }
        else
        {
            Console.WriteLine("Введите ID игрока, которго хотите разбанить: ");

            id = GetUserInputInt();

            if (TryGetPlayer(id, out Player player) && player.IsBanned == true)
            {
                player.Unban();
                Console.WriteLine("Игрок разбанен.");
                Console.ReadKey();
                Console.Clear();
            }
            else
            {
                ShowMassegeNoPlayer() ;
            }
        }
    }

    private void ShowMessageEmptyData()
    {
        Console.WriteLine("База данных пуста.");
        Console.ReadKey();
        Console.Clear();
    }

    private void ShowMassegeNoPlayer()
    {
        Console.WriteLine("Пользователь с таким ID не найден.");
        Console.ReadKey();
        Console.Clear();
    }

    private bool TryGetPlayer(int id, out Player player)
    {
        player = _players.Find(player => player.Id == id);

        return player != null;
    }

    private bool IsPlayerExist(int id)
    {
        foreach (Player player in _players)
        {
            if (player.Id == id)
            {
                return true;
            }
        }

        return false;
    }
    private string GetUserInput(string message, string errorMessage, bool addAnEmptyLineIfAnErrorOccured = true)
    {
        bool success = true;
        string value;

        do
        {
            Console.Write(message);
            value = Console.ReadLine();
            success = !string.IsNullOrWhiteSpace(value);
            if (success == false)
            {
                Console.WriteLine(errorMessage);
                if (addAnEmptyLineIfAnErrorOccured)
                {
                    Console.WriteLine();
                }
            }
        }
        while (success == false);

        return value;
    }

    private static int GetUserInputInt()
    {
        int value;
        string userInput;

        userInput = Console.ReadLine();

        while (int.TryParse(userInput, out value) == false)
        {
            Console.WriteLine("Введено некорректное значение, попробуй еще раз.");
            userInput = Console.ReadLine();
        }

        return value;
    }
}
